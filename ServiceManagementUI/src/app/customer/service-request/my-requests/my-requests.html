<div class="requests-container fade-in">
    <!-- Header Section -->
    <div class="header-section">
        <div>
            <h1 class="page-title">My Service Requests</h1>
            <p class="page-subtitle">Track and manage the progress of your service requests</p>
        </div>
        <div class="stats-mini">
            <div class="stat-pill">
                <span class="label">Total</span>
                <span class="value">{{stats.total}}</span>
            </div>
            <div class="stat-pill pending">
                <span class="label">Pending</span>
                <span class="value">{{stats.pending}}</span>
            </div>
            <div class="stat-pill completed">
                <span class="label">Completed</span>
                <span class="value">{{stats.completed}}</span>
            </div>
        </div>
    </div>

    <!-- Filters & Search -->
    <mat-card class="glass-card table-controls">
        <div class="controls-wrapper">
            <mat-form-field appearance="outline" class="search-field">
                <mat-icon matPrefix>search</mat-icon>
                <mat-label>Search Requests</mat-label>
                <input matInput (keyup)="applyFilter($event)" placeholder="Search by ID, Service, or Issue...">
            </mat-form-field>

            <mat-form-field appearance="outline" class="filter-field">
                <mat-icon matPrefix>filter_list</mat-icon>
                <mat-label>Status Filter</mat-label>
                <mat-select (selectionChange)="filterByStatus($event.value)">
                    <mat-option value="">All Statuses</mat-option>
                    <mat-option value="Requested">Requested</mat-option>
                    <mat-option value="Assigned">Assigned</mat-option>
                    <mat-option value="InProgress">In Progress</mat-option>
                    <mat-option value="Completed">Completed</mat-option>
                    <mat-option value="Cancelled">Cancelled</mat-option>
                </mat-select>
            </mat-form-field>
        </div>
    </mat-card>

    <!-- Requests Table -->
    <div class="table-container glass-card">
        <table mat-table [dataSource]="dataSource" matSort class="requests-table">

            <!-- Request ID Column -->
            <ng-container matColumnDef="requestId">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
                <td mat-cell *matCellDef="let request">
                    <span class="id-badge">#{{request.requestId}}</span>
                </td>
            </ng-container>

            <!-- Service Column -->
            <ng-container matColumnDef="serviceName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Service Details</th>
                <td mat-cell *matCellDef="let request">
                    <div class="service-info">
                        <div class="service-name">{{request.serviceName}}</div>
                        <div class="service-category">
                            <mat-icon>category</mat-icon> {{request.categoryName}}
                        </div>
                    </div>
                </td>
            </ng-container>

            <!-- Issue Column -->
            <ng-container matColumnDef="issueDescription">
                <th mat-header-cell *matHeaderCellDef>Issue Description</th>
                <td mat-cell *matCellDef="let request">
                    <div class="issue-text" [matTooltip]="request.issueDescription">
                        {{request.issueDescription | slice:0:50}}{{request.issueDescription.length > 50 ? '...' : ''}}
                    </div>
                </td>
            </ng-container>

            <!-- Priority Column -->
            <ng-container matColumnDef="priority">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Priority</th>
                <td mat-cell *matCellDef="let request">
                    <span class="priority-badge" [ngClass]="'priority-' + request.priority.toLowerCase()">
                        <mat-icon class="badge-icon">
                            {{request.priority === 'High' ? 'priority_high' : (request.priority === 'Medium' ?
                            'drag_handle' : 'low_priority')}}
                        </mat-icon>
                        {{request.priority}}
                    </span>
                </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
                <td mat-cell *matCellDef="let request">
                    <span class="status-badge" [ngClass]="'status-' + request.status.toLowerCase()">
                        {{request.status}}
                    </span>
                </td>
            </ng-container>

            <!-- Date Column -->
            <ng-container matColumnDef="scheduledDate">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Schedule</th>
                <td mat-cell *matCellDef="let request">
                    <div class="date-info">
                        <mat-icon>event</mat-icon>
                        {{request.scheduledDate | date:'MMM d, y, h:mm a'}}
                    </div>
                </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let request">
                    <div class="action-buttons">
                        <button mat-icon-button (click)="viewDetails(request)" class="action-btn view-btn"
                            matTooltip="View Details">
                            <mat-icon>visibility</mat-icon>
                        </button>
                        <button mat-icon-button (click)="cancelRequest(request.requestId)" class="action-btn cancel-btn"
                            *ngIf="canCancel(request.status)" matTooltip="Cancel Request">
                            <mat-icon>cancel</mat-icon>
                        </button>
                        <button mat-icon-button (click)="giveFeedback(request)" class="action-btn feedback-btn"
                            *ngIf="request.status === 'Completed'" matTooltip="Give Feedback">
                            <mat-icon>rate_review</mat-icon>
                        </button>
                    </div>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
        </table>

        <div *ngIf="dataSource.data.length === 0" class="empty-state">
            <div class="empty-icon-wrapper">
                <mat-icon>inbox</mat-icon>
            </div>
            <h3>No Requests Found</h3>
            <p>Start by creating your first service request</p>
            <button mat-raised-button color="primary" routerLink="/customer/create-request">
                <mat-icon>add</mat-icon> Create Request
            </button>
        </div>

        <mat-paginator [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons class="custom-paginator"
            *ngIf="dataSource.data.length > 0">
        </mat-paginator>
    </div>
</div>